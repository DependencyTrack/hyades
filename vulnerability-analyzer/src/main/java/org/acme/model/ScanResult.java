package org.acme.model;

import io.quarkus.runtime.annotations.RegisterForReflection;

import java.util.List;
import java.util.Objects;

@RegisterForReflection
public record ScanResult(ScanKey key, AnalyzerIdentity scanner, ScanStatus status,
                         List<Vulnerability> vulnerabilities, String failureReason) {

    public static Builder builder(final ScanKey scanKey, final AnalyzerIdentity identity) {
        return new Builder(scanKey, identity);
    }

    public static final class Builder {

        private final ScanKey scanKey;
        private final AnalyzerIdentity identity;
        private ScanStatus status;
        private List<Vulnerability> vulnerabilities;
        private String failureReason;

        private Builder(final ScanKey scanKey, final AnalyzerIdentity scanner) {
            this.scanKey = Objects.requireNonNull(scanKey, "scanKey must not be null");
            this.identity = Objects.requireNonNull(scanner, "scanner must not be null");
        }

        public Builder withStatus(final ScanStatus status) {
            this.status = status;
            return this;
        }

        public Builder withVulnerabilities(final List<Vulnerability> vulnerabilities) {
            this.vulnerabilities = vulnerabilities;
            return this;
        }

        public Builder withFailureReason(final String failureReason) {
            this.failureReason = failureReason;
            return this;
        }

        public ScanResult build() {
            return new ScanResult(scanKey, identity, Objects.requireNonNull(status, "status must not be null"),
                    vulnerabilities, failureReason);
        }

    }

}
