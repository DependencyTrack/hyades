package org.hyades.metrics;

import org.apache.kafka.streams.processor.api.Processor;
import org.apache.kafka.streams.processor.api.ProcessorSupplier;
import org.apache.kafka.streams.state.KeyValueStore;
import org.apache.kafka.streams.state.StoreBuilder;
import org.hyades.model.DependencyMetrics;

import javax.enterprise.context.ApplicationScoped;
import javax.inject.Inject;
import javax.inject.Named;
import java.util.Set;

@ApplicationScoped
public class DeltaProcessorSupplier implements ProcessorSupplier<String, DependencyMetrics, String, DependencyMetrics> {

    private final StoreBuilder<KeyValueStore<String, DependencyMetrics>> deltaStoreBuilder;

    @Inject
    public DeltaProcessorSupplier(@Named("deltaStoreBuilder") final StoreBuilder<KeyValueStore<String, DependencyMetrics>> batchStoreBuilder) {
        this.deltaStoreBuilder = batchStoreBuilder;
    }

    @Override
    public Processor<String, DependencyMetrics, String, DependencyMetrics> get() {
        return new DeltaProcessor(deltaStoreBuilder.name());
    }

    @Override
    public Set<StoreBuilder<?>> stores() {
        return Set.of(deltaStoreBuilder);
    }

}
