package org.hyades.config;

import io.smallrye.config.SmallRyeConfig;
import org.apache.kafka.streams.state.RocksDBConfigSetter;
import org.eclipse.microprofile.config.ConfigProvider;
import org.rocksdb.Options;

import java.util.Map;

public class RocksDbConfigSetter implements RocksDBConfigSetter {

    @Override
    public void setConfig(final String storeName, final Options options, final Map<String, Object> configs) {
        final SmallRyeConfig config = ConfigProvider.getConfig().unwrap(SmallRyeConfig.class);
        final StateStoreConfig stateStoreConfig = config.getConfigMapping(StateStoreConfig.class);

        stateStoreConfig.rocksDb().compactionStyle().ifPresent(options::setCompactionStyle);
        stateStoreConfig.rocksDb().compressionType().ifPresent(options::setCompressionType);
    }

    @Override
    public void close(final String storeName, final Options options) {
    }

}
