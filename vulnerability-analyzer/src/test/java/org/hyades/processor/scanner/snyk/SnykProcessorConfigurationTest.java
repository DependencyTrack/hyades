package org.hyades.processor.scanner.snyk;

import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.junit.QuarkusTestProfile;
import io.quarkus.test.junit.TestProfile;
import jakarta.inject.Named;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.junit.platform.suite.api.SelectClasses;
import org.junit.platform.suite.api.Suite;

import java.util.Map;
import java.util.Set;

@Suite
@SelectClasses(value = {
        SnykProcessorConfigurationTest.TestIsSupportedCustomPurlType.class,
        SnykProcessorConfigurationTest.TestIsSupportedStandardPurlType.class,
        SnykProcessorConfigurationTest.TestIsNotSupportedPurlType.class
})
class SnykProcessorConfigurationTest {
    @QuarkusTest
    @TestProfile(TestIsNotSupportedPurlType.TestProfile.class)
    static class TestIsNotSupportedPurlType {
        public static class TestProfile implements QuarkusTestProfile {

            @Override
            public Map<String, String> getConfigOverrides() {
                return Map.of(
                        "scanner.snyk.input-package-urls", "test",
                        "scanner.snyk.custom-package-urls-supported", "swift",
                        "scanner.snyk.enabled", "true",
                        "quarkus.kafka.snappy.enabled", "false"
                );
            }
        }

        @Named("snykSupportedPackageUrlTypes")
        Set<String> listReturned;

        @Test
        void test() {
            Assertions.assertEquals(Set.of(), listReturned);
        }
    }

    @QuarkusTest
    @TestProfile(TestIsSupportedCustomPurlType.TestProfile.class)
    static class TestIsSupportedCustomPurlType {
        public static class TestProfile implements QuarkusTestProfile {
            @Override
            public Map<String, String> getConfigOverrides() {
                return Map.of(
                        "scanner.snyk.input-package-urls", "swift",
                        "scanner.snyk.custom-package-urls-supported", "swift",
                        "scanner.snyk.enabled", "true",
                        "quarkus.kafka.snappy.enabled", "false"
                );
            }
        }

        @Named("snykSupportedPackageUrlTypes")
        Set<String> listReturned;


        @Test
        void testIsSupportedPurlType() {
            Assertions.assertEquals(Set.of("swift"), listReturned);
        }
    }

    @QuarkusTest
    @TestProfile(TestIsSupportedStandardPurlType.TestProfile.class)
    static class TestIsSupportedStandardPurlType {
        public static class TestProfile implements QuarkusTestProfile {
            @Override
            public Map<String, String> getConfigOverrides() {
                return Map.of(
                        "scanner.snyk.input-package-urls", "golang",
                        "scanner.snyk.enabled", "true",
                        "quarkus.kafka.snappy.enabled", "false"
                );
            }
        }

        @Named("snykSupportedPackageUrlTypes")
        Set<String> listReturned;


        @Test
        void testIsSupportedPurlType() {
            Assertions.assertEquals(Set.of("golang"), listReturned);
        }
    }

}
