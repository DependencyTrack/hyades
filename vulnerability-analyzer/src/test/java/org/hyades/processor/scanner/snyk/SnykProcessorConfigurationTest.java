package org.hyades.processor.scanner.snyk;

import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.junit.QuarkusTestProfile;
import io.quarkus.test.junit.TestProfile;
import jakarta.inject.Named;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import java.util.Map;
import java.util.Set;

class SnykProcessorConfigurationTest {
    @QuarkusTest
    @TestProfile(TestIsNotSupportedPurlType.TestProfile.class)
    static class TestIsNotSupportedPurlType {
        public static class TestProfile implements QuarkusTestProfile {

            @Override
            public Map<String, String> getConfigOverrides() {
                return Map.of(
                        "scanner.snyk.supported-package-url", "test"
                );
            }
        }

        @Named("snykSupportedPackageUrlTypes")
        Set<String> listReturned;

        @Test
        void test() {
            Assertions.assertEquals(Set.of(), listReturned);
        }
    }

    @QuarkusTest
    @TestProfile(TestIsSupportedCustomPurlType.TestProfile.class)
    static class TestIsSupportedCustomPurlType {
        public static class TestProfile implements QuarkusTestProfile {
            @Override
            public Map<String, String> getConfigOverrides() {
                return Map.of(
                        "scanner.snyk.supported-package-url", "cocoapods"
                );
            }
        }

        @Named("snykSupportedPackageUrlTypes")
        Set<String> listReturned;


        @Test
        void testIsSupportedPurlType() {
            Assertions.assertEquals(Set.of("conan", "conda"), listReturned);
        }
    }

    @QuarkusTest
    @TestProfile(TestIsSupportedStandardPurlType.TestProfile.class)
    static class TestIsSupportedStandardPurlType {
        public static class TestProfile implements QuarkusTestProfile {
            @Override
            public Map<String, String> getConfigOverrides() {
                return Map.of(
                        "scanner.snyk.supported-package-url", "golang"
                );
            }
        }

        @Named("snykSupportedPackageUrlTypes")
        Set<String> listReturned;


        @Test
        void testIsSupportedPurlType() {
            Assertions.assertEquals(Set.of("npm"), listReturned);
        }
    }

}
