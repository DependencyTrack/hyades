package org.hyades.processor.scanner.ossindex;

import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.junit.QuarkusTestProfile;
import io.quarkus.test.junit.TestProfile;
import jakarta.inject.Named;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.junit.platform.suite.api.SelectClasses;
import org.junit.platform.suite.api.Suite;

import java.util.Map;
import java.util.Set;


@Suite
@SelectClasses(value = {
        OssIndexProcessorConfigurationTest.TestIsSupportedCustomPurlType.class,
        OssIndexProcessorConfigurationTest.TestIsSupportedStandardPurlType.class,
        OssIndexProcessorConfigurationTest.TestIsNotSupportedPurlType.class
})
class OssIndexProcessorConfigurationTest {

    @QuarkusTest
    @TestProfile(TestIsNotSupportedPurlType.TestProfile.class)
    static class TestIsNotSupportedPurlType {
        public static class TestProfile implements QuarkusTestProfile {

            @Override
            public Map<String, String> getConfigOverrides() {
                return Map.of(
                        "scanner.ossindex.supported-package-url", "test",
                        "scanner.ossindex.enabled", "true",
                        "quarkus.kafka.snappy.enabled", "false"
                );
            }
        }

        @Named("ossSupportedPackageUrlTypes")
        Set<String> listReturned;

        @Test
        void test() {
            Assertions.assertEquals(Set.of(), listReturned);
        }
    }


    @QuarkusTest
    @TestProfile(TestIsSupportedCustomPurlType.TestProfile.class)
    static class TestIsSupportedCustomPurlType {
        public static class TestProfile implements QuarkusTestProfile {
            @Override
            public Map<String, String> getConfigOverrides() {
                return Map.of(
                        "scanner.ossindex.supported-package-url", "conan",
                        "scanner.ossindex.enabled", "true",
                        "quarkus.kafka.snappy.enabled", "false"
                );
            }
        }

        @Named("ossSupportedPackageUrlTypes")
        Set<String> listReturned;


        @Test
        void testIsSupportedPurlType() {
            Assertions.assertEquals(Set.of("conan"), listReturned);
        }
    }

    @QuarkusTest
    @TestProfile(TestIsSupportedStandardPurlType.TestProfile.class)
    static class TestIsSupportedStandardPurlType {
        public static class TestProfile implements QuarkusTestProfile {
            @Override
            public Map<String, String> getConfigOverrides() {
                return Map.of(
                        "scanner.ossindex.supported-package-url", "npm",
                        "scanner.ossindex.enabled", "true",
                        "quarkus.kafka.snappy.enabled", "false"
                );
            }
        }

        @Named("ossSupportedPackageUrlTypes")
        Set<String> listReturned;


        @Test
        void testIsSupportedPurlType() {
            Assertions.assertEquals(Set.of("npm"), listReturned);
        }
    }

}
