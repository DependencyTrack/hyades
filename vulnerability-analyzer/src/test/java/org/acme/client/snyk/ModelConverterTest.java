package org.acme.client.snyk;

import org.acme.model.Vulnerability;
import org.acme.resolver.CweResolver;
import org.junit.jupiter.api.Test;
import java.util.List;

import static org.acme.client.snyk.ModelConverter.convert;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;

public class ModelConverterTest {

    @Test
    public void testModelConverter() {

        Issue issue = new Issue(
                "test-key", "", "", "", "2022-11-21T19:50:45Z", "2021-04-14T20:04:52Z",
                List.of(new Problem("id1", "CVE", "test@test.com"), new Problem("CWE-100", "CWE", "")), null,
                List.of(new Severity(SeveritySource.SNYK, "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L", 7.3f, "HIGH"))
        );

        Vulnerability vulnerability = convert(CweResolver.getInstance(), SeveritySource.SNYK, issue);
        assertNotNull(vulnerability);
        assertEquals("test-key", vulnerability.getVulnId());
        assertEquals("SNYK", vulnerability.getSource());
        assertEquals("Tue Nov 22 01:20:45 IST 2022", vulnerability.getCreated().toString());
        assertEquals("Thu Apr 15 01:34:52 IST 2021", vulnerability.getUpdated().toString());
        assertEquals(1, vulnerability.getAliases().size());
        assertEquals("id1", vulnerability.getAliases().get(0).getCveId());
        assertEquals(100, vulnerability.getCwes().get(0));
        assertEquals("HIGH", vulnerability.getSeverity().toString());
        assertEquals("CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L", vulnerability.getCvssV3Vector());
    }
}
