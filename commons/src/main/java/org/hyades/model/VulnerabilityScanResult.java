package org.hyades.model;

import io.quarkus.runtime.annotations.RegisterForReflection;

import java.util.List;
import java.util.Objects;

@RegisterForReflection
public record VulnerabilityScanResult(VulnerabilityScanKey key, AnalyzerIdentity scanner, VulnerabilityScanStatus status,
                                      List<Vulnerability> vulnerabilities, String failureReason) {

    public static Builder builder(final VulnerabilityScanKey vulnerabilityScanKey, final AnalyzerIdentity identity) {
        return new Builder(vulnerabilityScanKey, identity);
    }

    public static final class Builder {

        private final VulnerabilityScanKey vulnerabilityScanKey;
        private final AnalyzerIdentity identity;
        private VulnerabilityScanStatus status;
        private List<Vulnerability> vulnerabilities;
        private String failureReason;

        private Builder(final VulnerabilityScanKey vulnerabilityScanKey, final AnalyzerIdentity scanner) {
            this.vulnerabilityScanKey = Objects.requireNonNull(vulnerabilityScanKey, "scanKey must not be null");
            this.identity = Objects.requireNonNull(scanner, "scanner must not be null");
        }

        public Builder withStatus(final VulnerabilityScanStatus status) {
            this.status = status;
            return this;
        }

        public Builder withVulnerabilities(final List<Vulnerability> vulnerabilities) {
            this.vulnerabilities = vulnerabilities;
            return this;
        }

        public Builder withFailureReason(final String failureReason) {
            this.failureReason = failureReason;
            return this;
        }

        public VulnerabilityScanResult build() {
            return new VulnerabilityScanResult(vulnerabilityScanKey, identity, Objects.requireNonNull(status, "status must not be null"),
                    vulnerabilities, failureReason);
        }

    }

}
